<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Watch & Earn</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body { background:#000; color:#fff; text-align:center; font-family:Arial; }
iframe { width:100%; max-width:420px; height:240px; border-radius:10px; }
</style>
</head>
<body>

<h3>ðŸŽ¬ Watch & Earn</h3>
<iframe id="player" allowfullscreen></iframe>
<p id="status">Loading...</p>

<script>
const API_URL = "https://view4server.onrender.com";

const tg = window.Telegram.WebApp;
tg.ready();

// âœ… FIX: ensure user ID exists
const user = tg.initDataUnsafe?.user || { id: "test_user" };

console.log("USER ID:", user.id);

let sessionId;

async function loadVideo() {
  const res = await fetch(API_URL + "/get-video", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ user_id: user.id })
  });

  const data = await res.json();
  console.log("API response:", data);

  if (data.status === "no_videos") {
    document.getElementById("status").innerText = "No videos available";
    return;
  }

  sessionId = data.session_id;
  document.getElementById("player").src = data.url + "?autoplay=1&mute=1";
  document.getElementById("status").innerText = "Watching...";
}

loadVideo();
</script>

</body>
</html>
