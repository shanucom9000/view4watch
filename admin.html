<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body{font-family:Arial;background:#0f172a;color:white;padding:20px}
.card{background:#1e293b;padding:20px;margin:10px 0;border-radius:10px}
button{padding:8px 12px;margin:5px;background:#3b82f6;border:none;color:white;border-radius:6px}
input,textarea{width:100%;padding:10px;margin:5px 0;border-radius:6px;border:none}
</style>
</head>
<body>

<div id="login" class="card">
<h2>Admin Login</h2>
<input id="key" placeholder="API Key">
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<div id="panel" style="display:none">

<div class="card">
<button onclick="loadUsers()">Users</button>
<button onclick="broadcast()">Broadcast</button>
<button onclick="revenue()">Revenue</button>
</div>

<div id="content"></div>

<div class="card">
<h3>Private Message</h3>
<input id="uid" placeholder="User ID">
<textarea id="pmsg"></textarea>
<button onclick="privateMsg()">Send</button>
</div>

</div>

<script>
const API="https://view4server.onrender.com";
let KEY="";

function login(){
 KEY=document.getElementById("key").value;
 fetch(API+"/admin/stats",{headers:{"X-API-KEY":KEY}})
 .then(r=>{if(!r.ok)throw 1; return r.json()})
 .then(()=>{login.style.display="none"; panel.style.display="block"})
 .catch(()=>msg.innerText="Invalid Key");
}

function loadUsers(){
 fetch(API+"/admin/users",{headers:{"X-API-KEY":KEY}})
 .then(r=>r.json())
 .then(data=>{
   let html="<div class='card'><h3>Total Users: "+Object.keys(data).length+"</h3>";
   for(let id in data){
     html+=`<p>${id} â€” ${data[id].balance||0} pts</p>`;
   }
   html+="</div>";
   content.innerHTML=html;
 });
}

function broadcast(){
 let m=prompt("Message:");
 fetch(API+"/admin/broadcast",{
  method:"POST",
  headers:{"Content-Type":"application/json","X-API-KEY":KEY},
  body:JSON.stringify({message:m})
 });
}

function privateMsg(){
 fetch(API+"/admin/message/"+uid.value,{
  method:"POST",
  headers:{"Content-Type":"application/json","X-API-KEY":KEY},
  body:JSON.stringify({message:pmsg.value})
 });
 alert("Sent");
}

function revenue(){
 fetch(API+"/admin/revenue",{headers:{"X-API-KEY":KEY}})
 .then(r=>r.json())
 .then(d=>content.innerHTML=`<div class='card'>Views: ${d.total_views}<br>Points: ${d.points_spent}</div>`);
}
</script>

</body>
</html>
