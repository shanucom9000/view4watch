<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>API Admin Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  margin:0;
  font-family:Segoe UI;
  background:#020617;
  color:white;
}
header {
  padding:20px;
  font-size:22px;
  background:#111827;
}
.container { padding:20px; }
button {
  padding:8px 12px;
  border:none;
  border-radius:6px;
  background:#2563eb;
  color:white;
  cursor:pointer;
}
input, textarea {
  padding:8px;
  border-radius:6px;
  border:none;
  margin:5px;
}
.section { margin-top:25px; }
table {
  width:100%;
  border-collapse: collapse;
  margin-top:10px;
}
th, td {
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,0.1);
  text-align:center;
}
</style>
</head>

<body>
<header>ğŸš€ API Admin Dashboard</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox">
<h2>Admin Login</h2>
<input id="user" placeholder="Username"><br>
<input id="pass" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
<p id="loginMsg"></p>
</div>

<!-- TOKEN INPUT -->
<div id="tokenBox" style="display:none">
<h2>ğŸ”‘ Enter Admin Token</h2>
<p>Copy the token shown above and paste here</p>
<input id="manualToken" placeholder="Paste token here">
<button onclick="saveToken()">Continue</button>
<p id="tokenMsg"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none">

<h2>ğŸ‘¥ Users</h2>
<table id="usersTable">
<tr><th>UID</th><th>Plan</th><th>Balance</th><th>Usage</th></tr>
</table>

<div class="section">
<h2>ğŸ“¢ Broadcast Message</h2>
<textarea id="broadcastMsg" rows="3" style="width:100%" placeholder="Enter message"></textarea>
<button onclick="broadcast()">Send to All Users</button>
</div>

</div>
</div>

<script>
const API_BASE = "https://instaapipro.onrender.com";
let token="";

/* ================= LOGIN ================= */
function login(){
  const username = document.getElementById("user").value.trim();
  const password = document.getElementById("pass").value.trim();

  if(!username || !password){
    loginMsg.innerText = "âš ï¸ Enter username & password";
    return;
  }

  fetch(`${API_BASE}/admin/login`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,password})
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.token){
      loginMsg.innerText = "âœ… Login successful!\n\nCopy this token:";
      loginMsg.innerText += "\n\n" + data.token;
      tokenBox.style.display="block";
    } else {
      loginMsg.innerText = "âŒ Incorrect username or password";
    }
  })
  .catch(()=>loginMsg.innerText="ğŸš« Cannot reach API server");
}

/* ================= SAVE TOKEN ================= */
function saveToken(){
  token = manualToken.value.trim();

  if(!token){
    tokenMsg.innerText="âš ï¸ Please enter token";
    return;
  }

  tokenMsg.innerText="âœ… Token accepted";
  tokenBox.style.display="none";
  dashboard.style.display="block";
  loadUsers();
}

/* ================= LOAD USERS ================= */
function loadUsers(){
 fetch(`${API_BASE}/admin/users`,{
   headers:{"X-Admin-Token":token}
 })
 .then(res=>{
   if(res.status===403){
     alert("âŒ Invalid token");
     return;
   }
   return res.json();
 })
 .then(showUsers)
 .catch(()=>alert("âš ï¸ Failed to load users"));
}

/* ================= SHOW USERS ================= */
function showUsers(users){
 let table=document.getElementById("usersTable");
 table.innerHTML="<tr><th>UID</th><th>Plan</th><th>Balance</th><th>Usage</th></tr>";

 if(!users || users.length===0){
   table.innerHTML += "<tr><td colspan='4'>No users found</td></tr>";
   return;
 }

 users.forEach(u=>{
   table.innerHTML+=`
   <tr>
     <td>${u.uid}</td>
     <td>${u.plan}</td>
     <td>â‚¹${u.balance}</td>
     <td>${u.usage}</td>
   </tr>`;
 });
}

/* ================= BROADCAST ================= */
function broadcast(){
  const message = broadcastMsg.value.trim();

  if(!message){
    alert("âš ï¸ Enter message");
    return;
  }

 fetch(`${API_BASE}/admin/broadcast`,{
  method:"POST",
  headers:{
    "Content-Type":"application/json",
    "X-Admin-Token":token
  },
  body:JSON.stringify({message})
 })
 .then(res=>{
   if(res.status===403){
     alert("âŒ Invalid token");
     return;
   }
   alert("âœ… Broadcast sent");
 })
 .catch(()=>alert("âŒ Broadcast failed"));
}
</script>

</body>
</html>
