<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<style>
body{font-family:Segoe UI;background:#020617;color:white;margin:0}
header{background:#111827;padding:20px;font-size:22px}
.container{padding:20px}
button{padding:6px 10px;border:none;border-radius:6px;background:#2563eb;color:white;cursor:pointer}
input,textarea{padding:8px;border-radius:6px;border:none;margin:5px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.1);text-align:center}
.section{margin-top:30px}
</style>
</head>
<body>

<header>ğŸš€ Admin Dashboard</header>
<div class="container">

<div id="loginBox">
<h2>Login</h2>
<input id="user" placeholder="Username"><br>
<input id="pass" type="password" placeholder="Password"><br>
<button onclick="login()">Login</button>
<p id="msg"></p>
</div>

<div id="dashboard" style="display:none">

<h2>ğŸ‘¥ Users</h2>
<table id="usersTable"></table>

<div class="section">
<h2>ğŸ“¢ Broadcast</h2>
<textarea id="broadcastMsg" rows="3" style="width:100%"></textarea>
<button onclick="broadcast()">Send</button>
</div>

<div class="section">
<h2>ğŸ”‘ Provider Keys</h2>
<table id="keysTable"></table>
<input id="newKey" placeholder="New API key">
<button onclick="addKey()">Add</button>
</div>

</div>
</div>

<script>
const API="https://instaapipro.onrender.com";

function login(){
 fetch(`${API}/admin/login`,{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  credentials:"include",
  body:JSON.stringify({username:user.value,password:pass.value})
 })
 .then(r=>{if(!r.ok){msg.innerText="âŒ Login failed";return;}
  msg.innerText="âœ… Logged in";
  loginBox.style.display="none";dashboard.style.display="block";
  loadUsers();loadKeys();
 });
}

function loadUsers(){
 fetch(`${API}/admin/users`,{credentials:"include"})
 .then(r=>r.json()).then(users=>{
  let t=usersTable;
  t.innerHTML=`<tr><th>UID</th><th>Plan</th><th>Balance</th><th>Usage</th><th>Actions</th></tr>`;
  users.forEach(u=>{
   t.innerHTML+=`<tr>
   <td>${u.uid}</td><td>${u.plan}</td><td>â‚¹${u.balance}</td><td>${u.usage}</td>
   <td>
   <button onclick="bal('${u.uid}',1)">+â‚¹</button>
   <button onclick="bal('${u.uid}',-1)">-â‚¹</button>
   <button onclick="plan('${u.uid}','pro')">Pro</button>
   <button onclick="plan('${u.uid}','basic')">Basic</button>
   <button onclick="msgUser('${u.uid}')">ğŸ“©</button>
   <button onclick="delUser('${u.uid}')">âŒ</button>
   </td></tr>`;
  });
 });
}

function bal(uid,a){fetch(`${API}/admin/update_balance`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({uid,amount:a})}).then(loadUsers)}
function plan(uid,p){fetch(`${API}/admin/update_plan`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({uid,plan:p})}).then(loadUsers)}
function delUser(uid){if(confirm("Delete?"))fetch(`${API}/admin/delete_user`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({uid})}).then(loadUsers)}
function msgUser(uid){let m=prompt("Message");if(m)fetch(`${API}/admin/message_user`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({uid,message:m})})}
function broadcast(){fetch(`${API}/admin/broadcast`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({message:broadcastMsg.value})})}

function loadKeys(){
 fetch(`${API}/admin/provider_keys`,{credentials:"include"})
 .then(r=>r.json()).then(keys=>{
  keysTable.innerHTML="<tr><th>ID</th><th>Status</th><th>Last Failed</th><th>Action</th></tr>";
  keys.forEach(k=>{
   keysTable.innerHTML+=`<tr>
   <td>${k.id}</td><td>${k.status}</td><td>${k.last_failed}</td>
   <td><button onclick="toggleKey('${k.id}')">Toggle</button></td></tr>`;
  });
 });
}

function toggleKey(id){fetch(`${API}/admin/toggle_key`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id})}).then(loadKeys)}
function addKey(){fetch(`${API}/admin/add_key`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({key:newKey.value})}).then(()=>{newKey.value="";loadKeys();})}
</script>
</body>
</html>
